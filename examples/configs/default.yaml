calib:
  data: "pileval"
  num_samples: 128
  seq_length: 1024
  min_length: 0
  max_length: 0
  seed: 42

transform:
  path: "output/qoq/transform"
  rotate:
    enabled: true
    random: false
    rotate_out: true   
    rotate_down: false 

  reorder:
    enabled: true
    reorder_out: false 
    reorder_down: true 

  smooth:
    enabled: true
    smooth_attn: true  
    smooth_qkv: false  
    smooth_vo: false  
    smooth_ffn: false 
    smooth_down: true 
    proj_alpha: 0.3
    proj_beta: 0.7
    attn_alpha: 0.5
    attn_beta: 0

quant:
  path: "output/qoq/quant"
  weight:
    args:
      bits: 4
      symmetric: false
      strategy: "group"
      group_shapes: [[1, -1], [1, 128]]
      zero_domain: "PostScale"
      intermediate_bits: 8
      observer: "memoryless-minmax"
    mod:
      method: "gptq"
      block_size: 128
      perc_damp: 0.01
  
  input:
    args:
      bits: 8
      symmetric: true
      strategy: "token"
      dynamic: true
      observer: "minmax"
  
  output:
    args:
      bits: 4
      symmetric: false
      strategy: "group"
      group_shapes: [[1, 128]]
      zero_domain: "PostScale"
      dynamic: true
      observer: "minmax"
    mod:
      skips: "q_proj"

eval:
  ppl:
    datasets:
      - wikitext
    num_samples: 128
    seq_length: 2048
  lm_eval:
    tasks:
      - hellaswag
      - piqa
      - winogrande
      - arc_easy
      - arc_challenge
    num_fewshot: 0
    batch_size: 4
  compare_baseline: true
  output_path: "output/qoq/results.json"
